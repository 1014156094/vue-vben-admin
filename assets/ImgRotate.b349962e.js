var e=Object.assign;import{d as t,r as s,a as i,u as a,ai as r,q as o,j as n,e as m,m as d,a0 as c,bd as g}from"./index.ab86ea0e.js";import"./_stringToArray.c6e9c157.js";import{h as u}from"./domUtils.77ddbe1d.js";import"./CheckOutlined.04c29d08.js";import"./DoubleRightOutlined.4fa9f0a9.js";import{u as p}from"./useTimeout.5e8ddc88.js";import"./useExpose.34c51c0a.js";import{r as l,B as h}from"./DragVerify.cfe08dac.js";var f=t({name:"ImgRotateDargVerify",inheritAttrs:!1,props:l,emits:["success","change","update:value"],setup(t,{emit:l,attrs:f}){const T=s(null),v=i({showTip:!1,isPassing:!1,imgStyle:{},randomRotate:0,currentRotate:0,toOrigin:!1,startTime:0,endTime:0,draged:!1}),{t:y}=a();r((()=>v.isPassing),(e=>{if(e){const{startTime:t,endTime:s}=v;l("success",{isPassing:e,time:((s-t)/1e3).toFixed(1)}),l("change",e),l("update:value",e)}}));const w=o((()=>{const{imgWrapStyle:s,imgWidth:i}=t;return e({width:`${i}px`,height:`${i}px`},s)})),D=o((()=>{const{minDegree:e,maxDegree:s}=t;return e===s?Math.floor(1+1*Math.random())/10+1:1}));function j(){v.startTime=(new Date).getTime()}function x(e){v.draged=!0;const{imgWidth:s,height:i,maxDegree:a}=t,{moveX:r}=e,o=Math.ceil(r/(s-parseInt(i))*a*m(D));v.currentRotate=o,v.imgStyle=u("transform",`rotateZ(${v.randomRotate-o}deg)`)}function R(){const{minDegree:e,maxDegree:s}=t,i=Math.floor(e+Math.random()*(s-e));v.randomRotate=i,v.imgStyle=u("transform",`rotateZ(${i}deg)`)}function _(){const{randomRotate:e,currentRotate:s}=v,{diffDegree:i}=t;Math.abs(e-s)>=(i||20)?(v.imgStyle=u("transform",`rotateZ(${e}deg)`),v.toOrigin=!0,p((()=>{v.toOrigin=!1,v.showTip=!0}),300)):(v.isPassing=!0,v.endTime=(new Date).getTime()),v.showTip=!0}function P(){v.showTip=!1;const e=m(T);e&&(v.isPassing=!1,e.resume(),R())}const S=g();return S&&(S.resume=P),()=>{const{src:s}=t,{toOrigin:i,isPassing:a,startTime:r,endTime:o}=v,g=[];i&&g.push("to-origin");const u=(o-r)/1e3;return n("div",{class:"ir-dv"},[n("div",{class:"ir-dv-img__wrap",style:m(w)},[n("img",{src:s,onLoad:R,width:parseInt(t.width),class:g,style:v.imgStyle,onClick:()=>{P()}},null),v.showTip&&n("span",{class:["ir-dv-img__tip",v.isPassing?"success":"error"]},[v.isPassing?y("component.verify.time",{time:u.toFixed(1)}):y("component.verify.error")]),!v.showTip&&!v.draged&&n("span",{class:["ir-dv-img__tip","normal"]},[d("t('redoTip')")])]),n(h,c({class:"ir-dv-drag__bar",onMove:x,onEnd:_,onStart:j,ref:T},e(e({},f),t),{value:a,isSlot:!0}),null)])}}});export default f;