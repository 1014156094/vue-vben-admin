import{u as e,a as t,b as s,r as i,aI as n,ai as a,v as o,cU as r,T as c,f as u,aJ as l,cV as d,z as m}from"./index.fa77065c.js";import{C as g}from"./CheckOutlined.f93c980e.js";import{D as p}from"./DoubleRightOutlined.3c333eda.js";import{u as f}from"./useTimeout.f7769a48.js";import{u as h}from"./useEventListener.e42e7868.js";import{h as y}from"./domUtils.aee0a6fd.js";const{t:v}=e(),T={value:{type:Boolean,default:!1},isSlot:{type:Boolean,default:!1},text:{type:[String],default:v("component.verify.dragText")},successText:{type:[String],default:v("component.verify.successText")},height:{type:[Number,String],default:40},width:{type:[Number,String],default:220},circle:{type:Boolean,default:!1},wrapStyle:{type:Object,default:{}},contentStyle:{type:Object,default:{}},barStyle:{type:Object,default:{}},actionStyle:{type:Object,default:{}}},w={...T,src:{type:String},imgWidth:{type:Number,default:260},imgWrapStyle:{type:Object,default:{}},minDegree:{type:Number,default:90},maxDegree:{type:Number,default:270},diffDegree:{type:Number,default:20}};var x=t({name:"BaseDargVerify",props:T,emits:["success","update:value","change","start","move","end"],setup(e,{emit:t,slots:d}){const m=s({isMoving:!1,isPassing:!1,moveDistance:0,toLeft:!1,startTime:0,endTime:0}),y=i(null),v=i(null),T=i(null),w=i(null);n((()=>m.isPassing),(e=>{if(e){const{startTime:s,endTime:i}=m;t("success",{isPassing:e,time:((i-s)/1e3).toFixed(1)}),t("update:value",e),t("change",e)}})),a((()=>{m.isPassing=!!e.value}));const x=o((()=>{const{height:t,actionStyle:s}=e,i=`${parseInt(t)}px`;return{left:0,width:i,height:i,...s}})),S=o((()=>{const{height:t,width:s,circle:i,wrapStyle:n}=e,a=parseInt(t);return{width:`${parseInt(s)}px`,height:`${a}px`,lineHeight:`${a}px`,borderRadius:i?a/2+"px":0,...n}})),D=o((()=>{const{height:t,circle:s,barStyle:i}=e,n=parseInt(t);return{height:`${n}px`,borderRadius:s?n/2+"px 0 0 "+n/2+"px":0,...i}})),b=o((()=>{const{height:t,width:s,contentStyle:i}=e;return{height:`${parseInt(t)}px`,width:`${parseInt(s)}px`,...i}}));function M(e){return e.pageX||e.touches[0].pageX}function P(e){if(m.isPassing)return;const s=u(w);s&&(t("start",e),m.moveDistance=M(e)-parseInt(s.style.left.replace("px",""),10),m.startTime=(new Date).getTime(),m.isMoving=!0)}function $(t){const s=parseInt(t.style.width),{width:i}=e,n=parseInt(i);return{offset:n-s-6,widthNum:n,actionWidth:s}}function I(s){const{isMoving:i,moveDistance:n}=m;if(i){const i=u(w),a=u(v);if(!i||!a)return;const{offset:o,widthNum:r,actionWidth:c}=$(i),l=M(s)-n;t("move",{event:s,moveDistance:n,moveX:l}),l>0&&l<=o?(i.style.left=`${l}px`,a.style.width=`${l+c/2}px`):l>o&&(i.style.left=r-c+"px",a.style.width=r-c/2+"px",e.isSlot||j())}}function R(s){const{isMoving:i,isPassing:n,moveDistance:a}=m;if(i&&!n){t("end",s);const i=u(w),n=u(v);if(!i||!n)return;const o=M(s)-a,{offset:r,widthNum:c,actionWidth:l}=$(i);o<r?e.isSlot?setTimeout((()=>{if(e.value){const e=u(T);e&&(e.style.width=`${parseInt(n.style.width)}px`)}else O()}),0):O():(i.style.left=c-l+"px",n.style.width=c-l/2+"px",j()),m.isMoving=!1}}function j(){e.isSlot?O():(m.endTime=(new Date).getTime(),m.isPassing=!0,m.isMoving=!1)}function O(){m.isMoving=!1,m.isPassing=!1,m.moveDistance=0,m.toLeft=!1,m.startTime=0,m.endTime=0;const e=u(w),t=u(v),s=u(T);e&&t&&s&&(m.toLeft=!0,f((()=>{m.toLeft=!1,e.style.left="0",t.style.width="0"}),300),s.style.width=u(b).width)}return h({el:document,name:"mouseup",listener:()=>{m.isMoving&&O()}}),r((e=>{e.resume=O})),()=>c("div",{class:"darg-verify",ref:y,style:u(S),onMousemove:I,onTouchmove:I,onMouseleave:R,onMouseup:R,onTouchend:R},(()=>{const e=["darg-verify-bar"];return m.toLeft&&e.push("to-left"),c("div",{class:e,ref:v,style:u(D)})})(),(()=>{const t=["darg-verify-content"],{isPassing:s}=m,{text:i,successText:n}=e;return s&&t.push("success"),c("div",{class:t,ref:T,style:u(b)},l(d,"text",s)||(s?n:i))})(),(()=>{const e=["darg-verify-action"],{toLeft:t,isPassing:s}=m;return t&&e.push("to-left"),c("div",{class:e,onMousedown:P,onTouchstart:P,style:u(x),ref:w},l(d,"actionIcon",s)||c(s?g:p,{class:"darg-verify-action__icon"}))})())}}),S=t({name:"ImgRotateDargVerify",inheritAttrs:!1,props:w,emits:["success","change","update:value"],setup(t,{emit:a,attrs:r}){const l=i(null),m=s({showTip:!1,isPassing:!1,imgStyle:{},randomRotate:0,currentRotate:0,toOrigin:!1,startTime:0,endTime:0,draged:!1}),{t:g}=e();n((()=>m.isPassing),(e=>{if(e){const{startTime:t,endTime:s}=m;a("success",{isPassing:e,time:((s-t)/1e3).toFixed(1)}),a("change",e),a("update:value",e)}}));const p=o((()=>{const{imgWrapStyle:e,imgWidth:s}=t;return{width:`${s}px`,height:`${s}px`,...e}})),h=o((()=>{const{minDegree:e,maxDegree:s}=t;return e===s?Math.floor(1+1*Math.random())/10+1:1}));function v(){m.startTime=(new Date).getTime()}function T(e){m.draged=!0;const{imgWidth:s,height:i,maxDegree:n}=t,{moveX:a}=e,o=Math.ceil(a/(s-parseInt(i))*n*u(h));m.currentRotate=o,m.imgStyle=y("transform",`rotateZ(${m.randomRotate-o}deg)`)}function w(){const{minDegree:e,maxDegree:s}=t,i=Math.floor(e+Math.random()*(s-e));m.randomRotate=i,m.imgStyle=y("transform",`rotateZ(${i}deg)`)}function S(){const{randomRotate:e,currentRotate:s}=m,{diffDegree:i}=t;Math.abs(e-s)>=(i||20)?(m.imgStyle=y("transform",`rotateZ(${e}deg)`),m.toOrigin=!0,f((()=>{m.toOrigin=!1,m.showTip=!0}),300)):(m.isPassing=!0,m.endTime=(new Date).getTime()),m.showTip=!0}function D(){m.showTip=!1;const e=u(l);e&&(m.isPassing=!1,e.$.resume(),w())}const b=d();return b&&(b.resume=D),()=>{const{src:e}=t,{toOrigin:s,isPassing:i,startTime:n,endTime:a}=m,o=[];s&&o.push("to-origin");const d=(a-n)/1e3;return c("div",{class:"ir-dv"},c("div",{class:"ir-dv-img__wrap",style:u(p)},c("img",{src:e,onLoad:w,width:parseInt(t.width),class:o,style:m.imgStyle,onClick:()=>{D()}}),m.showTip&&c("span",{class:["ir-dv-img__tip",m.isPassing?"success":"error"]},m.isPassing?g("component.verify.time",{time:d.toFixed(1)}):g("component.verify.error")),!m.showTip&&!m.draged&&c("span",{class:["ir-dv-img__tip","normal"]},"t('redoTip')")),c(x,{class:"ir-dv-drag__bar",onMove:T,onEnd:S,onStart:v,ref:l,...{...r,...t},value:i,isSlot:!0}))}}});m(x,S);export{x as B,S as R};