import{a as e,r as t,f as s,o as a,j as l,ab as n,ac as o,k as r,y as c,u as i,i as u,w as m,x as d,z as f}from"./index.e84487d5.js";import{x as p}from"./xlsx.a48e520c.js";import{s as h}from"./index.c5b45e58.js";import{B as x,a as y}from"./index.c7a54259.js";import{u as k}from"./useForm.c435b577.js";var v=e({name:"ImportExcel",emits:["success","error"],setup(e,{emit:a}){const l=t(null),n=t(!1);function o(e){if(!e||!e["!ref"])return[];const t=[],s=p.utils.decode_range(e["!ref"]),a=s.s.r;for(let l=s.s.c;l<=s.e.c;++l){const s=e[p.utils.encode_cell({c:l,r:a})];let n="UNKNOWN "+l;s&&s.t&&(n=p.utils.format_cell(s)),t.push(n)}return t}function r(e){return n.value=!0,new Promise(((t,s)=>{const l=new FileReader;l.onload=async e=>{try{const s=e.target&&e.target.result,l=function(e){const t=[];for(const s of e.SheetNames){const a=e.Sheets[s],l=o(a),n=p.utils.sheet_to_json(a);t.push({header:l,results:n,meta:{sheetName:s}})}return t}(p.read(s,{type:"array"}));a("success",l),t("")}catch(e){s(e),a("error")}finally{n.value=!1}},l.readAsArrayBuffer(e)}))}return{handleUpload:function(){const e=s(l);e&&e.click()},handleInputClick:function(e){const t=e&&e.target.files,a=t&&t[0];a&&async function(e){const t=s(l);t&&(t.value=""),await r(e)}(a)},inputRef:l}}});v.render=function(e,t,s,i,u,m){return a(),l("div",null,[n(r("input",{ref:"inputRef",type:"file",accept:".xlsx, .xls",onChange:t[1]||(t[1]=(...t)=>e.handleInputClick&&e.handleInputClick(...t))},null,544),[[o,!1]]),r("div",{onClick:t[2]||(t[2]=(...t)=>e.handleUpload&&e.handleUpload(...t))},[c(e.$slots,"default")])])};const{t:g}=i(),b=[{field:"filename",component:"Input",label:g("component.excel.fileName"),rules:[{required:!0}]},{field:"bookType",component:"Select",label:g("component.excel.fileType"),defaultValue:"xlsx",rules:[{required:!0}],componentProps:{options:[{label:"xlsx",value:"xlsx",key:"xlsx"},{label:"html",value:"html",key:"html"},{label:"csv",value:"csv",key:"csv"},{label:"txt",value:"txt",key:"txt"}]}}];var j=e({components:{BasicModal:x,BasicForm:h},emits:["success","register"],setup(e,{emit:t}){const[s,{validateFields:a}]=k(),[l,{closeModal:n}]=y();return{schemas:b,handleOk:async function(){const e=await a(),{filename:s,bookType:l}=e;t("success",{filename:`${s.split(".").shift()}.${l}`,bookType:l}),n()},registerForm:s,registerModal:l,t:g}}});j.render=function(e,t,s,n,o,c){const i=u("BasicForm"),f=u("BasicModal");return a(),l(f,d(e.$attrs,{title:e.t("component.excel.exportModalTitle"),onOk:e.handleOk,onRegister:e.registerModal}),{default:m((()=>[r(i,{labelWidth:100,schemas:e.schemas,showActionButtonGroup:!1,onRegister:e.registerForm},null,8,["schemas","onRegister"])])),_:1},16,["title","onOk","onRegister"])},f(v,j);export{v as a,j as s};