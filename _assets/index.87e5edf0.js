import{u as e,q as t,ae as o,f as n,a,a7 as s,W as l,b0 as r,aQ as i,da as c,d9 as u,r as d,s as f,O as p,Q as g,cv as m,bK as h,F as b,av as v,ad as y,cA as w,dh as H,dd as C,b as x,cn as F,df as S,cr as O,t as k,cO as M,y as B}from"./index.a952a825.js";import{C as P}from"./CloseOutlined.56cac908.js";import{F as j,a as E}from"./FullscreenOutlined.2cf0b23d.js";import{u as T}from"./useTimeout.3c09ffad.js";import{e as W,g as N}from"./tsxHelper.50b89473.js";import{B as $}from"./index.53160084.js";import{a as q,r as A}from"./resizeEvent.167fcdb9.js";import{s as L}from"./index.d9bface4.js";import{u as R}from"./useWindowSizeFn.03a16a67.js";const{t:I}=e(),z={visible:t.bool,draggable:t.bool.def(!0),centered:t.bool,cancelText:t.string.def(I("component.modal.cancelText")),okText:t.string.def(I("component.modal.okText")),closeFunc:Function},Q=Object.assign({},z,{canFullscreen:t.bool.def(!0),wrapperFooterOffset:t.number.def(0),helpMessage:[String,Array],useWrapper:t.bool.def(!0),loading:t.bool,showCancelBtn:t.bool.def(!0),showOkBtn:t.bool.def(!0),wrapperProps:Object,afterClose:Function,bodyStyle:Object,closable:{type:Boolean,default:!0},closeIcon:Object,confirmLoading:Boolean,destroyOnClose:Boolean,footer:Object,getContainer:Function,mask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},maskStyle:Object,okType:{type:String,default:"primary"},okButtonProps:Object,cancelButtonProps:Object,title:{type:String},visible:Boolean,width:[String,Number],wrapClassName:{type:String},zIndex:{type:Number}});function X(e){const t=(e,t)=>getComputedStyle(e)[t],a=o=>{if(!o)return;o.setAttribute("data-drag",n(e.draggable));const a=o.querySelector(".ant-modal-header"),s=o.querySelector(".ant-modal");a&&s&&n(e.draggable)&&(a.style.cursor="move",a.onmousedown=e=>{if(!e)return;const o=e.clientX,n=e.clientY,a=document.body.clientWidth,l=document.documentElement.clientHeight,r=s.offsetWidth,i=s.offsetHeight,c=s.offsetLeft,u=a-s.offsetLeft-r,d=s.offsetTop,f=l-s.offsetTop-i,p=t(s,"left"),g=t(s,"top");let m=+p,h=+g;p.includes("%")?(m=+document.body.clientWidth*(+p.replace(/%/g,"")/100),h=+document.body.clientHeight*(+g.replace(/%/g,"")/100)):(m=+p.replace(/px/g,""),h=+g.replace(/px/g,"")),document.onmousemove=function(e){let t=e.clientX-o,a=e.clientY-n;-t>c?t=-c:t>u&&(t=u),-a>d?a=-d:a>f&&(a=f),s.style.cssText+=`;left:${t+m}px;top:${a+h}px;`},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null}})};o((()=>{n(e.visible)&&n(e.draggable)&&T((()=>{(()=>{const o=document.querySelectorAll(".ant-modal-wrap");for(const s of Array.from(o)){if(!s)continue;const o=t(s,"display"),l=s.getAttribute("data-drag");"none"!==o&&(null===l||n(e.destroyOnClose))&&a(s)}})()}),30)}))}var Y=a({name:"Modal",inheritAttrs:!1,props:Q,setup(e,{attrs:t,slots:o}){const{visible:n,draggable:a,destroyOnClose:i}=s(e);return X({visible:n,destroyOnClose:i,draggable:a}),()=>{const n={...t,...e};return l(r,{...n},W(o))}}});const G=Symbol();function K(){return u(G)}var D=a({name:"ModalWrapper",props:{loading:t.bool,modalHeaderHeight:t.number.def(50),modalFooterHeight:t.number.def(54),minHeight:t.number.def(200),footerOffset:t.number.def(0),visible:t.bool,fullScreen:t.bool},emits:["heightChange","getExtHeight"],setup(e,{slots:t,emit:a}){const s=d(null),r=d(null),u=d(0);let v=()=>{};R(w),c({redoModalHeight:w},G);const y=f((()=>({minHeight:`${e.minHeight}px`,height:`${n(u)}px`,overflow:"auto"})));async function w(){if(!e.visible)return;const t=n(s);if(!t)return;const o=t.parentElement;if(o){o.style.padding="0",await b();try{const t=o.parentElement&&o.parentElement.parentElement;if(!t)return;const s=getComputedStyle(t).top,l=Number.parseInt(s);let i=window.innerHeight-2*l+(e.footerOffset||0)-e.modalFooterHeight-e.modalHeaderHeight;l<40&&(i-=26),await b();const c=n(r);if(!c)return;const d=c.$el.querySelector(".ant-spin-container");if(!d)return;const f=d.scrollHeight;e.fullScreen?u.value=window.innerHeight-e.modalFooterHeight-e.modalHeaderHeight:u.value=f>i?i:f+16+30,a("heightChange",n(u)),b((()=>{const e=c.$el;e&&(e.style.height=`${n(u)}px`)}))}catch(e){}}}return o((()=>{w()})),p((()=>e.fullScreen),(e=>{!e&&w()})),g((()=>{const{modalHeaderHeight:t,modalFooterHeight:o}=e;a("getExtHeight",t+o),function(){const e=n(s);if(!e)return;const t=e.querySelector(".ant-spin-container");if(!t)return;const[o,a]=function(e,t,o=100,n){let a=()=>{t()};const[s,l]=i(a,o,n);return a=o?s:a,[function(){q(e,a)},function(){A(e,a),l()}]}(t,(()=>{w()}));v=a,o()}()})),m((()=>{v&&v()})),()=>l("div",{ref:s,style:n(y)},l(h,{ref:r,spinning:e.loading},(()=>N(t))))}});var J=a({name:"BasicModal",props:Q,emits:["visible-change","height-change","cancel","ok","register"],setup(e,{slots:t,emit:a,attrs:s}){const r=d(!1),i=d(null),c=d(null),u=d(0),g=f((()=>({...e,...n(i)}))),{handleFullScreen:m,getWrapClassName:h,fullScreenRef:b}=function(e){const t=d(0),o=d(!1);return{getWrapClassName:f((()=>{const t=n(e.wrapClassName)||"";return n(o)?`fullscreen-modal ${t} `:n(t)})),handleFullScreen:function(a){a&&a.stopPropagation(),o.value=!n(o);const s=n(e.modalWrapperRef);if(!s)return;const l=s.$el;if(!l)return;const r=l.querySelector(".ant-spin-nested-loading");r&&(!n(t)&&n(o)&&(t.value=r.offsetHeight),n(o)?r.style.height=window.innerHeight-n(e.extHeightRef)+"px":r.style.height=`${n(t)}px`)},fullScreenRef:o}}({modalWrapperRef:c,extHeightRef:u,wrapClassName:v(g.value,"wrapClassName")}),x=f((()=>({...{...n(g),visible:n(r),title:void 0},wrapClassName:n(h)}))),F=f((()=>({...s,...n(x)})));async function S(t){if(null==t||t.stopPropagation(),e.closeFunc&&w(e.closeFunc)){const t=await e.closeFunc();r.value=!t}else r.value=!1,a("cancel")}o((()=>{r.value=!!e.visible})),p((()=>n(r)),(e=>{a("visible-change",e)}),{immediate:!1});const O={setModalProps:function(e){i.value=C(n(i)||{},e),Reflect.has(e,"visible")&&(r.value=!!e.visible)}};return H((e=>{a("register",O,e.uid)})),()=>l(Y,{onCancel:S,...n(F)},{footer:()=>function(){const{showCancelBtn:e,cancelButtonProps:o,cancelText:s,showOkBtn:r,okType:i,okText:c,okButtonProps:u,confirmLoading:d}=n(x);return l(y,null,N(t,"insertFooter"),e&&l(L,{...o,onClick:S},(()=>s)),N(t,"centerdFooter"),r&&l(L,{type:i,loading:d,onClick:()=>{a("ok")},...u},(()=>c)),N(t,"appendFooter"))}(),closeIcon:()=>function(){const{canFullscreen:e}=n(x),t=n(b)?l(j,{role:"full",onClick:m}):l(E,{role:"close",onClick:m});return l("div",{class:["custom-close-icon",{"can-full":e}]},e&&t,l(P,{onClick:S}))}(),title:()=>function(){const{helpMessage:e}=n(x),{title:o}=n(g);return l($,{helpMessage:e},(()=>t.title?N(t,"title"):o))}(),...W(t,["default"]),default:()=>function(){const{useWrapper:o,loading:s,wrapperProps:i}=n(x);if(!o)return N(t);const d=void 0===e.footer||e.footer?void 0:0;return l(D,{footerOffset:e.wrapperFooterOffset,fullScreen:n(b),ref:c,loading:s,visible:n(r),modalFooterHeight:d,...i,onGetExtHeight:e=>{u.value=e},onHeightChange:e=>{a("height-change",e)}},(()=>N(t)))}()})}});const U=x({});function V(){if(!F())throw new Error("Please put useModal function in the setup function!");const e=d(null),t=d(!1),o=d("");const a=()=>{const t=n(e);if(!t)throw new Error("instance is undefined!");return t};return[function(a,s){o.value=s,m((()=>{e.value=null,t.value=!1,U[n(o)]=null})),n(t)&&S()&&a===n(e)||(e.value=a)},{setModalProps:e=>{a().setModalProps(e)},openModal:(e=!0,t,s=!0)=>{if(a().setModalProps({visible:e}),!t)return;if(s)return U[n(o)]=null,void(U[n(o)]=t);O(k(U[n(o)]),t)||(U[n(o)]=t)}}]}const Z=e=>{const t=d(null),a=F(),s=d("");if(!a)throw new Error("instance is undefined!");const l=()=>{const e=n(t);if(!e)throw new Error("instance is undefined!");return e};return o((()=>{const t=U[n(s)];t&&e&&w(e)&&b((()=>{e(t)}))})),[(e,o)=>{M((()=>{t.value=null})),s.value=o,t.value=e,a.emit("register",e,o)},{changeLoading:(e=!0)=>{l().setModalProps({loading:e})},changeOkLoading:(e=!0)=>{l().setModalProps({confirmLoading:e})},closeModal:()=>{l().setModalProps({visible:!1})},setModalProps:e=>{l().setModalProps(e)}}]};B(J);export{J as B,V as a,Z as b,K as u};