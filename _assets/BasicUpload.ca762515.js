let e=document.createElement("style");e.innerHTML=".thumb img[data-v-1c5b9d26]{position:static;display:block;width:104px;height:104px;-o-object-fit:cover;object-fit:cover}.file-table{width:100%;border-collapse:collapse}.file-table .center{text-align:center}.file-table .left{text-align:left}.file-table .right{text-align:right}.file-table-td,.file-table-th{padding:12px 8px}.file-table thead{background-color:#f0f2f5}.file-table table,.file-table td,.file-table th{border:1px solid #ebeef5}.upload-modal .ant-upload-list{display:none}.upload-modal .ant-table-wrapper .ant-spin-nested-loading{padding:0}.upload-modal-toolbar{display:flex;align-items:center;margin-bottom:8px}.upload-modal-toolbar__btn{margin-left:8px;text-align:right;flex:1}.upload-preview-modal .ant-upload-list{display:none}.upload-preview-modal .ant-table-wrapper .ant-spin-nested-loading{padding:0}",document.head.appendChild(e);import{u as t,s as a,f as o,a as n,q as l,cR as i,cS as r,o as s,j as u,m as d,aR as c,R as p,cH as m,r as f,b as g,a7 as b,h,dw as v,i as x,w,k as R,p as C,n as y,v as S,O as U,ad as j}from"./index.acbb87a5.js";import"./xlsx.a48e520c.js";import"./Trigger.7e5aa3a2.js";import{o as k}from"./omit.e88f0464.js";import"./_baseSlice.1123a25b.js";import"./CheckOutlined.3360de48.js";import{A as P}from"./index.76ecadf4.js";import"./colors.4e87fc28.js";import"./index.e51afa00.js";import"./RightOutlined.31cb4cc9.js";import"./index.4bc096ce.js";import"./types.1d435903.js";import{U as L}from"./index.f03014a9.js";import"./_baseFor.f4e5f03f.js";import"./index.a172b251.js";import{T as I}from"./index.428f9fc4.js";import"./index.f39ff197.js";import{T as O}from"./index.687a618a.js";import{T as M}from"./TableAction.cfd8ad49.js";import{P as N}from"./index.402d573f.js";import"./FileOutlined.d01c0d19.js";import"./CloseOutlined.c0e09c7a.js";import"./DownOutlined.f6157dc5.js";import"./LeftOutlined.e2617435.js";import{c as A}from"./functional.cca96ab1.js";import"./RightOutlined.0108934f.js";import{I as T}from"./index.0c60de8b.js";import"./index.c0cb7618.js";import{B,a as _,u as E}from"./index.33af1ccc.js";import{b as F}from"./uuid.40269c00.js";import{a as z}from"./download.e9462bb5.js";const{t:D}=t();var H,$;($=H||(H={})).SUCCESS="success",$.ERROR="error",$.UPLOADING="uploading";const G={helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:Infinity},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},uploadParams:{type:Object,default:{}},api:{type:Function,default:null,required:!0}},W={value:{type:Array,default:()=>[]},...G,showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}},q={value:{type:Array,default:()=>[]}},V={columns:{type:[Array],default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}};function K(e){return J(e.name)}function J(e){return/\.(jpg|jpeg|png|gif)$/i.test(e)}var Q=n({props:{fileUrl:l.string.def(""),fileName:l.string.def("")}});const X=c("data-v-1c5b9d26");i("data-v-1c5b9d26");const Y={class:"thumb"};r();const Z=X(((e,t,a,o,n,l)=>(s(),u("span",Y,[e.fileUrl?(s(),u("img",{key:0,src:e.fileUrl},null,8,["src"])):d("",!0)]))));Q.render=Z,Q.__scopeId="data-v-1c5b9d26";const{t:ee}=t();function te(e,t){return{width:120,title:ee("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:a})=>{const o=[{label:ee("component.upload.del"),color:"error",onClick:e.bind(null,a)}];return K(a)&&o.unshift({label:ee("component.upload.preview"),onClick:t.bind(null,a)}),p(M,{actions:o})}}}function ae({handleRemove:e,handlePreview:t,handleDownload:a}){return{width:160,title:ee("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:o})=>{const{url:n}=o||{},l=[{label:ee("component.upload.del"),color:"error",onClick:e.bind(null,o)},{label:ee("component.upload.download"),onClick:a.bind(null,o)}];return J(n)&&l.unshift({label:ee("component.upload.preview"),onClick:t.bind(null,o)}),p(M,{actions:l})}}}var oe=n({name:"FileList",props:V,setup:e=>()=>{const{columns:t,actionColumn:a,dataSource:o}=e,n=[...t,a];return p("table",{class:"file-table"},p("colgroup",null,n.map((e=>{const{width:t=0,dataIndex:a}=e;return p("col",{style:t?{width:`${t}px`,minWidth:`${t}px`}:{},key:a})}))),p("thead",null,p("tr",{class:"file-table-tr"},n.map((e=>{const{title:t="",align:a="center",dataIndex:o}=e;return p("th",{class:["file-table-th",a],key:o},t)})))),p("tbody",null,o.map(((e={},t)=>p("tr",{class:"file-table-tr",key:`${t+e.name||""}`},n.map((t=>{const{dataIndex:a="",customRender:o,align:n="center"}=t,l=o&&m(o);return p("td",{class:["file-table-td",n],key:a},l?null==o?void 0:o({text:e[a],record:e}):e[a])})))))))}}),ne=n({components:{BasicModal:B,Upload:L,Alert:P,FileList:oe},props:G,setup(e,{emit:n}){const{t:l}=t(),i=f(!1),r=f([]),s=g({fileList:[]}),[u,{closeModal:d}]=_(),{accept:c,helpText:x,maxNumber:w,maxSize:R}=b(e),{getAccept:C,getStringAccept:y,getHelpText:S}=function({acceptRef:e,helpTextRef:t,maxNumberRef:n,maxSizeRef:l}){const i=a((()=>{const t=o(e);return t&&t.length>0?t:[]})),r=a((()=>o(i).map((e=>`.${e}`)).join(","))),s=a((()=>{const a=o(t);if(a)return a;const i=[],r=o(e);r.length>0&&i.push(D("component.upload.accept",[r.join(",")]));const s=o(l);s&&i.push(D("component.upload.maxSize",[s]));const u=o(n);return u&&Infinity!==u&&i.push(D("component.upload.maxNumber",[u])),i.join("ï¼Œ")}));return{getAccept:i,getStringAccept:r,getHelpText:s}}({acceptRef:c,helpTextRef:x,maxNumberRef:w,maxSizeRef:R}),{createMessage:U}=h(),j=a((()=>r.value.length>0&&!r.value.every((e=>e.status===H.SUCCESS)))),k=a((()=>{const e=r.value.some((e=>e.status===H.SUCCESS));return{disabled:i.value||0===r.value.length||!e}})),P=a((()=>{const e=r.value.some((e=>e.status===H.ERROR));return i.value?l("component.upload.uploading"):l(e?"component.upload.reUploadFailed":"component.upload.startUpload")}));return{columns:[{dataIndex:"thumbUrl",title:ee("component.upload.legend"),width:100,customRender:({record:e})=>{const{thumbUrl:t}=e||{};return t&&p(Q,{fileUrl:t})}},{dataIndex:"name",title:ee("component.upload.fileName"),align:"left",customRender:({text:e,record:t})=>{const{percent:a,status:o}=t||{};let n="normal";return o===H.ERROR?n="exception":o===H.UPLOADING?n="active":o===H.SUCCESS&&(n="success"),p("span",null,p("p",{class:"ellipsis mb-1",title:e},e),p(N,{percent:a,size:"small",status:n}))}},{dataIndex:"size",title:ee("component.upload.fileSize"),width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{dataIndex:"status",title:ee("component.upload.fileStatue"),width:100,customRender:({text:e})=>e===H.SUCCESS?p(O,{color:"green"},(()=>ee("component.upload.uploadSuccess"))):e===H.ERROR?p(O,{color:"red"},(()=>ee("component.upload.uploadError"))):e===H.UPLOADING?p(O,{color:"blue"},(()=>ee("component.upload.uploading"))):e}],actionColumn:te((function(e){const t=r.value.findIndex((t=>t.uuid===e.uuid));-1!==t&&r.value.splice(t,1)}),(function(e){const{thumbUrl:t=""}=e;A({imageList:[t]})})),register:u,closeModal:d,getHelpText:S,getStringAccept:y,getOkButtonProps:k,beforeUpload:function(t){const{size:a,name:n}=t,{maxSize:i}=e,s=o(C);if(i&&t.size/1024/1024>=i)return U.error(l("component.upload.maxSizeMultiple",[i])),!1;if(s.length>0&&!function(e,t){const a=t.join("|");return new RegExp("\\.("+a+")$","i").test(e.name)}(t,s))return U.error(l("acomponent.upload.cceptUpload",[s.join(",")])),!1;const u={uuid:F(),file:t,size:a,name:n,percent:0,type:n.split(".").pop()};return K(t)?function(e){return new Promise(((t,a)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>t({result:o.result,file:e}),o.onerror=e=>a(e)}))}(t).then((({result:e})=>{r.value=[...o(r),{thumbUrl:e,...u}]})):r.value=[...o(r),u],!1},fileListRef:r,state:s,isUploadingRef:i,handleStartUpload:async function(){const{maxNumber:t}=e;if(r.value.length>t)return U.warning(l("component.upload.maxNumber",[t]));try{i.value=!0;const t=r.value.filter((e=>e.status!==H.SUCCESS))||[],a=await Promise.all(t.map((t=>async function(t){var a;const{api:o}=e;if(!o||!m(o))return v("upload api must exist and be a function");try{t.status=H.UPLOADING;const{data:o}=await(null==(a=e.api)?void 0:a.call(e,{...e.uploadParams||{},file:t.file},(function(e){const a=e.loaded/e.total*100|0;t.percent=a})));return t.status=H.SUCCESS,t.responseData=o,{success:!0,error:null}}catch(e){return t.status=H.ERROR,{success:!1,error:e}}}(t))));i.value=!1;const o=a.filter((e=>!e.success));if(o.length>0)throw o}catch(e){throw i.value=!1,e}},handleOk:function(){const{maxNumber:t}=e;if(r.value.length>t)return U.warning(l("component.upload.maxNumber",[t]));if(i.value)return U.warning(l("component.upload.saveWarn"));const a=[];for(const e of r.value){const{status:t,responseData:o}=e;t===H.SUCCESS&&o&&a.push(o.url)}if(a.length<=0)return U.warning(l("component.upload.saveError"));r.value=[],d(),n("change",a)},handleCloseFunc:function(){return i.value?(U.warning(l("component.upload.uploadWait")),!1):(r.value=[],!0)},getIsSelectFile:j,getUploadBtnText:P,t:l}}});const le={class:"upload-modal-toolbar"};ne.render=function(e,t,a,o,n,l){const i=x("a-button"),r=x("Alert"),d=x("Upload"),c=x("FileList"),p=x("BasicModal");return s(),u(p,S({width:"800px",title:e.t("component.upload.upload"),okText:e.t("component.upload.save")},e.$attrs,{onRegister:e.register,onOk:e.handleOk,closeFunc:e.handleCloseFunc,maskClosable:!1,keyboard:!1,wrapClassName:"upload-modal",okButtonProps:e.getOkButtonProps,cancelButtonProps:{disabled:e.isUploadingRef}}),{centerdFooter:w((()=>[R(i,{onClick:e.handleStartUpload,color:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:w((()=>[C(y(e.getUploadBtnText),1)])),_:1},8,["onClick","disabled","loading"])])),default:w((()=>[R("div",le,[R(r,{message:e.getHelpText,type:"info",banner:"",class:"upload-modal-toolbar__text"},null,8,["message"]),R(d,{accept:e.getStringAccept,multiple:e.multiple,"before-upload":e.beforeUpload,class:"upload-modal-toolbar__btn"},{default:w((()=>[R(i,{type:"primary"},{default:w((()=>[C(y(e.t("component.upload.choose")),1)])),_:1})])),_:1},8,["accept","multiple","before-upload"])]),R(c,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])])),_:1},16,["title","okText","onRegister","onOk","closeFunc","okButtonProps","cancelButtonProps"])};var ie=n({components:{BasicModal:B,FileList:oe},props:q,setup(e,{emit:a}){const[n,{closeModal:l}]=_(),{t:i}=t(),r=f([]);return U((()=>e.value),(e=>{r.value=[],e.forEach((e=>{r.value=[...o(r),{url:e,type:e.split(".").pop()||"",name:e.split("/").pop()||""}]}))}),{immediate:!0}),{t:i,register:n,closeModal:l,fileListRef:r,columns:[{dataIndex:"url",title:ee("component.upload.legend"),width:100,customRender:({record:e})=>{const{url:t}=e||{};return J(t)&&p(Q,{fileUrl:t})}},{dataIndex:"name",title:ee("component.upload.fileName"),align:"left"}],actionColumn:ae({handleRemove:function(e){const t=r.value.findIndex((t=>t.url===e.url));-1!==t&&(r.value.splice(t,1),a("list-change",r.value.map((e=>e.url))))},handlePreview:function(e){const{url:t=""}=e;A({imageList:[t]})},handleDownload:function(e){const{url:t=""}=e;z({url:t})}})}}});ie.render=function(e,t,a,o,n,l){const i=x("FileList"),r=x("BasicModal");return s(),u(r,S({width:"800px",title:e.t("component.upload.preview"),wrapClassName:"upload-preview-modal"},e.$attrs,{onRegister:e.register,showOkBtn:!1}),{default:w((()=>[R(i,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])])),_:1},16,["title","onRegister"])};var re=n({name:"BasicUpload",components:{UploadModal:ne,UploadPreviewModal:ie,Icon:T,Tooltip:I},props:W,setup(e,{emit:n,attrs:l}){const{t:i}=t(),[r,{openModal:s}]=E(),[u,{openModal:d}]=E(),c=f([]),p=a((()=>{const{emptyHidePreview:t}=e;return!t||(!t||c.value.length>0)})),m=a((()=>{const t={...l,...e};return k(t,"onChange")}));return U((()=>e.value),((e=[])=>{c.value=e}),{immediate:!0}),{registerUploadModal:r,openUploadModal:s,handleChange:function(e){c.value=[...o(c),...e||[]],n("change",c.value)},handlePreviewChange:function(e){c.value=[...e||[]],n("change",c.value)},registerPreviewModal:u,openPreviewModal:d,fileListRef:c,showPreview:p,bindValue:m,t:i}}});re.render=function(e,t,a,o,n,l){const i=x("a-button"),r=x("Icon"),c=x("Tooltip"),p=x("a-button-group"),m=x("UploadModal"),f=x("UploadPreviewModal");return s(),u("div",null,[R(p,null,{default:w((()=>[R(i,{type:"primary",onClick:e.openUploadModal,preIcon:"carbon:cloud-upload"},{default:w((()=>[C(y(e.t("component.upload.upload")),1)])),_:1},8,["onClick"]),e.showPreview?(s(),u(c,{key:0,placement:"bottom"},{title:w((()=>[C(y(e.t("component.upload.uploaded"))+" ",1),e.fileListRef.length?(s(),u(j,{key:0},[C(y(e.fileListRef.length),1)],64)):d("",!0)])),default:w((()=>[R(i,{onClick:e.openPreviewModal},{default:w((()=>[R(r,{icon:"bi:eye"}),e.fileListRef.length&&e.showPreviewNumber?(s(),u(j,{key:0},[C(y(e.fileListRef.length),1)],64)):d("",!0)])),_:1},8,["onClick"])])),_:1})):d("",!0)])),_:1}),R(m,S(e.bindValue,{onRegister:e.registerUploadModal,onChange:e.handleChange}),null,16,["onRegister","onChange"]),R(f,{value:e.fileListRef,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange},null,8,["value","onRegister","onListChange"])])};export default re;