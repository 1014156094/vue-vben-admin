import{u as e,q as t,ae as o,f as n,a as s,a7 as a,W as l,b0 as r,aQ as i,dc as c,dd as u,r as d,s as f,O as p,Q as g,cv as m,bK as h,F as b,av as v,ad as y,cA as w,de as H,d8 as C,b as x,cn as F,da as S,cr as O,t as k,cO as M,y as P}from"./index.c162a79a.js";import{C as j}from"./CloseOutlined.dd293c60.js";import{F as B,a as E}from"./FullscreenOutlined.f9d23297.js";import{u as T}from"./useTimeout.cef81bf6.js";import{e as W,g as N}from"./tsxHelper.f27b6047.js";import{a as $}from"./index.59e7dc66.js";import{a as q,r as A}from"./resizeEvent.26e30cc3.js";import{s as L}from"./index.abb63025.js";import{u as R}from"./useWindowSizeFn.85c877e0.js";const{t:I}=e(),z={visible:t.bool,draggable:t.bool.def(!0),centered:t.bool,cancelText:t.string.def(I("component.modal.cancelText")),okText:t.string.def(I("component.modal.okText")),closeFunc:Function},Q=Object.assign({},z,{canFullscreen:t.bool.def(!0),wrapperFooterOffset:t.number.def(0),helpMessage:[String,Array],useWrapper:t.bool.def(!0),loading:t.bool,showCancelBtn:t.bool.def(!0),showOkBtn:t.bool.def(!0),wrapperProps:Object,afterClose:Function,bodyStyle:Object,closable:{type:Boolean,default:!0},closeIcon:Object,confirmLoading:Boolean,destroyOnClose:Boolean,footer:Object,getContainer:Function,mask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},maskStyle:Object,okType:{type:String,default:"primary"},okButtonProps:Object,cancelButtonProps:Object,title:{type:String},visible:Boolean,width:[String,Number],wrapClassName:{type:String},zIndex:{type:Number}});function X(e){const t=(e,t)=>getComputedStyle(e)[t],s=o=>{if(!o)return;o.setAttribute("data-drag",n(e.draggable));const s=o.querySelector(".ant-modal-header"),a=o.querySelector(".ant-modal");s&&a&&n(e.draggable)&&(s.style.cursor="move",s.onmousedown=e=>{if(!e)return;const o=e.clientX,n=e.clientY,s=document.body.clientWidth,l=document.documentElement.clientHeight,r=a.offsetWidth,i=a.offsetHeight,c=a.offsetLeft,u=s-a.offsetLeft-r,d=a.offsetTop,f=l-a.offsetTop-i,p=t(a,"left"),g=t(a,"top");let m=+p,h=+g;p.includes("%")?(m=+document.body.clientWidth*(+p.replace(/%/g,"")/100),h=+document.body.clientHeight*(+g.replace(/%/g,"")/100)):(m=+p.replace(/px/g,""),h=+g.replace(/px/g,"")),document.onmousemove=function(e){let t=e.clientX-o,s=e.clientY-n;-t>c?t=-c:t>u&&(t=u),-s>d?s=-d:s>f&&(s=f),a.style.cssText+=`;left:${t+m}px;top:${s+h}px;`},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null}})};o((()=>{n(e.visible)&&n(e.draggable)&&T((()=>{(()=>{const o=document.querySelectorAll(".ant-modal-wrap");for(const a of Array.from(o)){if(!a)continue;const o=t(a,"display"),l=a.getAttribute("data-drag");"none"!==o&&(null===l||n(e.destroyOnClose))&&s(a)}})()}),30)}))}var Y=s({name:"Modal",inheritAttrs:!1,props:Q,setup(e,{attrs:t,slots:o}){const{visible:n,draggable:s,destroyOnClose:i}=a(e);return X({visible:n,destroyOnClose:i,draggable:s}),()=>{const n={...t,...e};return l(r,{...n},W(o))}}});const G=Symbol();function K(){return u(G)}var D=s({name:"ModalWrapper",props:{loading:t.bool,modalHeaderHeight:t.number.def(50),modalFooterHeight:t.number.def(54),minHeight:t.number.def(200),footerOffset:t.number.def(0),visible:t.bool,fullScreen:t.bool},emits:["heightChange","getExtHeight"],setup(e,{slots:t,emit:s}){const a=d(null),r=d(null),u=d(0);let v=()=>{};R(w),c({redoModalHeight:w},G);const y=f((()=>({minHeight:`${e.minHeight}px`,height:`${n(u)}px`,overflow:"auto"})));async function w(){if(!e.visible)return;const t=n(a);if(!t)return;const o=t.parentElement;if(o){o.style.padding="0",await b();try{const t=o.parentElement&&o.parentElement.parentElement;if(!t)return;const a=getComputedStyle(t).top,l=Number.parseInt(a);let i=window.innerHeight-2*l+(e.footerOffset||0)-e.modalFooterHeight-e.modalHeaderHeight;l<40&&(i-=26),await b();const c=n(r);if(!c)return;const d=c.$el.querySelector(".ant-spin-container");if(!d)return;const f=d.scrollHeight;e.fullScreen?u.value=window.innerHeight-e.modalFooterHeight-e.modalHeaderHeight:u.value=f>i?i:f+16+30,s("heightChange",n(u)),b((()=>{const e=c.$el;e&&(e.style.height=`${n(u)}px`)}))}catch(e){}}}return o((()=>{w()})),p((()=>e.fullScreen),(e=>{!e&&w()})),g((()=>{const{modalHeaderHeight:t,modalFooterHeight:o}=e;s("getExtHeight",t+o),function(){const e=n(a);if(!e)return;const t=e.querySelector(".ant-spin-container");if(!t)return;const[o,s]=function(e,t,o=100,n){let s=()=>{t()};const[a,l]=i(s,o,n);return s=o?a:s,[function(){q(e,s)},function(){A(e,s),l()}]}(t,(()=>{w()}));v=s,o()}()})),m((()=>{v&&v()})),()=>l("div",{ref:a,style:n(y)},l(h,{ref:r,spinning:e.loading},(()=>N(t))))}});var J=s({name:"BasicModal",props:Q,emits:["visible-change","height-change","cancel","ok","register"],setup(e,{slots:t,emit:s,attrs:a}){const r=d(!1),i=d(null),c=d(null),u=d(0),g=f((()=>({...e,...n(i)}))),{handleFullScreen:m,getWrapClassName:h,fullScreenRef:b}=function(e){const t=d(0),o=d(!1);return{getWrapClassName:f((()=>{const t=n(e.wrapClassName)||"";return n(o)?`fullscreen-modal ${t} `:n(t)})),handleFullScreen:function(s){s&&s.stopPropagation(),o.value=!n(o);const a=n(e.modalWrapperRef);if(!a)return;const l=a.$el;if(!l)return;const r=l.querySelector(".ant-spin-nested-loading");r&&(!n(t)&&n(o)&&(t.value=r.offsetHeight),n(o)?r.style.height=window.innerHeight-n(e.extHeightRef)+"px":r.style.height=`${n(t)}px`)},fullScreenRef:o}}({modalWrapperRef:c,extHeightRef:u,wrapClassName:v(g.value,"wrapClassName")}),x=f((()=>({...{...n(g),visible:n(r),title:void 0},wrapClassName:n(h)}))),F=f((()=>({...a,...n(x)})));async function S(t){if(null==t||t.stopPropagation(),e.closeFunc&&w(e.closeFunc)){const t=await e.closeFunc();r.value=!t}else r.value=!1,s("cancel")}o((()=>{r.value=!!e.visible})),p((()=>n(r)),(e=>{s("visible-change",e)}),{immediate:!1});const O={setModalProps:function(e){i.value=C(n(i)||{},e),Reflect.has(e,"visible")&&(r.value=!!e.visible)}};return H((e=>{s("register",O,e.uid)})),()=>l(Y,{onCancel:S,...n(F)},{footer:()=>function(){const{showCancelBtn:e,cancelButtonProps:o,cancelText:a,showOkBtn:r,okType:i,okText:c,okButtonProps:u,confirmLoading:d}=n(x);return l(y,null,N(t,"insertFooter"),e&&l(L,{...o,onClick:S},(()=>a)),N(t,"centerdFooter"),r&&l(L,{type:i,loading:d,onClick:()=>{s("ok")},...u},(()=>c)),N(t,"appendFooter"))}(),closeIcon:()=>function(){const{canFullscreen:e}=n(x),t=n(b)?l(B,{role:"full",onClick:m}):l(E,{role:"close",onClick:m});return l("div",{class:["custom-close-icon",{"can-full":e}]},e&&t,l(j,{onClick:S}))}(),title:()=>function(){const{helpMessage:e}=n(x),{title:o}=n(g);return l($,{helpMessage:e},(()=>t.title?N(t,"title"):o))}(),...W(t,["default"]),default:()=>function(){const{useWrapper:o,loading:a,wrapperProps:i}=n(x);if(!o)return N(t);const d=void 0===e.footer||e.footer?void 0:0;return l(D,{footerOffset:e.wrapperFooterOffset,fullScreen:n(b),ref:c,loading:a,visible:n(r),modalFooterHeight:d,...i,onGetExtHeight:e=>{u.value=e},onHeightChange:e=>{s("height-change",e)}},(()=>N(t)))}()})}});const U=x({});function V(){if(!F())throw new Error("Please put useModal function in the setup function!");const e=d(null),t=d(!1),o=d("");const s=()=>{const t=n(e);if(!t)throw new Error("instance is undefined!");return t};return[function(s,a){o.value=a,m((()=>{e.value=null,t.value=!1,U[n(o)]=null})),n(t)&&S()&&s===n(e)||(e.value=s)},{setModalProps:e=>{s().setModalProps(e)},openModal:(e=!0,t,a=!0)=>{if(s().setModalProps({visible:e}),!t)return;if(a)return U[n(o)]=null,void(U[n(o)]=t);O(k(U[n(o)]),t)||(U[n(o)]=t)}}]}const Z=e=>{const t=d(null),s=F(),a=d("");if(!s)throw new Error("instance is undefined!");const l=()=>{const e=n(t);if(!e)throw new Error("instance is undefined!");return e};return o((()=>{const t=U[n(a)];t&&e&&w(e)&&b((()=>{e(t)}))})),[(e,o)=>{M((()=>{t.value=null})),a.value=o,t.value=e,s.emit("register",e,o)},{changeLoading:(e=!0)=>{l().setModalProps({loading:e})},changeOkLoading:(e=!0)=>{l().setModalProps({confirmLoading:e})},closeModal:()=>{l().setModalProps({visible:!1})},setModalProps:e=>{l().setModalProps(e)}}]};P(J);export{J as B,V as a,Z as b,K as u};