let e=document.createElement("style");e.innerHTML=".thumb img[data-v-1c5b9d26]{position:static;display:block;width:104px;height:104px;-o-object-fit:cover;object-fit:cover}.file-table{width:100%;border-collapse:collapse}.file-table .center{text-align:center}.file-table .left{text-align:left}.file-table .right{text-align:right}.file-table-td,.file-table-th{padding:12px 8px}.file-table thead{background-color:#f0f2f5}.file-table table,.file-table td,.file-table th{border:1px solid #ebeef5}.upload-modal .ant-upload-list{display:none}.upload-modal .ant-table-wrapper .ant-spin-nested-loading{padding:0}.upload-modal-toolbar{display:flex;align-items:center;margin-bottom:8px}.upload-modal-toolbar__btn{margin-left:8px;text-align:right;flex:1}.upload-preview-modal .ant-upload-list{display:none}.upload-preview-modal .ant-table-wrapper .ant-spin-nested-loading{padding:0}",document.head.appendChild(e);import{u as t,p as o,f as a,a as n,W as l,X as i,o as r,j as s,l as u,Y as d,O as c,az as p,r as m,b as f,_ as g,h as b,dx as h,i as x,w as v,k as w,n as R,m as y,q as C,M as S,a8 as U}from"./index.a4c995c9.js";import"./xlsx.a48e520c.js";import"./Trigger.a445e86a.js";import{o as j}from"./omit.149aedfc.js";import"./_baseSlice.1123a25b.js";import"./CheckOutlined.0ff5e6b7.js";import{A as k}from"./index.149c1c14.js";import"./colors.1efe187d.js";import"./index.5f1f44bb.js";import"./RightOutlined.0310d066.js";import"./index.2bdd82eb.js";import"./types.0700a3df.js";import{U as P}from"./index.cc0d5910.js";import"./_baseFor.f4e5f03f.js";import"./index.a172b251.js";import{T as L}from"./index.d7919071.js";import"./index.3ae0f855.js";import{T as I}from"./index.13851d4b.js";import{T as M}from"./TableAction.9af41b2c.js";import{P as O}from"./index.96952a17.js";import"./FileOutlined.b96b57d2.js";import"./CloseOutlined.6993095c.js";import"./DownOutlined.39a8d1c3.js";import"./LeftOutlined.e6de4091.js";import{c as N}from"./functional.46443edd.js";import"./RightOutlined.fc1e80b2.js";import{I as T}from"./index.85a2c56f.js";import{p as A}from"./propTypes.7f710850.js";import"./index.2e04fe2b.js";import{B as _,a as B,u as E}from"./index.720a235c.js";import{u as F}from"./upload.2459edc6.js";import{b as z}from"./uuid.40269c00.js";import{a as D}from"./download.73adfd1d.js";const{t:$}=t();var H,G;(G=H||(H={})).SUCCESS="success",G.ERROR="error",G.UPLOADING="uploading";const W={helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:Infinity},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},uploadParams:{type:Object,default:{}},api:{type:Function,default:null,required:!0}},q={value:{type:Array,default:()=>[]},...W,showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}},V={value:{type:Array,default:()=>[]}},K={columns:{type:[Array],default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}};function X(e){return Y(e.name)}function Y(e){return/\.(jpg|jpeg|png|gif)$/i.test(e)}var J=n({props:{fileUrl:A.string.def(""),fileName:A.string.def("")}});const Q=d("data-v-1c5b9d26");l("data-v-1c5b9d26");const Z={class:"thumb"};i();const ee=Q(((e,t,o,a,n,l)=>(r(),s("span",Z,[e.fileUrl?(r(),s("img",{key:0,src:e.fileUrl},null,8,["src"])):u("",!0)]))));J.render=ee,J.__scopeId="data-v-1c5b9d26";const{t:te}=t();function oe(e,t){return{width:120,title:te("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:o})=>{const a=[{label:te("component.upload.del"),color:"error",onClick:e.bind(null,o)}];return X(o)&&a.unshift({label:te("component.upload.preview"),onClick:t.bind(null,o)}),c(M,{actions:a})}}}function ae({handleRemove:e,handlePreview:t,handleDownload:o}){return{width:160,title:te("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:a})=>{const{url:n}=a||{},l=[{label:te("component.upload.del"),color:"error",onClick:e.bind(null,a)},{label:te("component.upload.download"),onClick:o.bind(null,a)}];return Y(n)&&l.unshift({label:te("component.upload.preview"),onClick:t.bind(null,a)}),c(M,{actions:l})}}}var ne=n({name:"FileList",props:K,setup:e=>()=>{const{columns:t,actionColumn:o,dataSource:a}=e,n=[...t,o];return c("table",{class:"file-table"},c("colgroup",null,n.map((e=>{const{width:t=0,dataIndex:o}=e;return c("col",{style:t?{width:`${t}px`,minWidth:`${t}px`}:{},key:o})}))),c("thead",null,c("tr",{class:"file-table-tr"},n.map((e=>{const{title:t="",align:o="center",dataIndex:a}=e;return c("th",{class:["file-table-th",o],key:a},t)})))),c("tbody",null,a.map(((e={},t)=>c("tr",{class:"file-table-tr",key:`${t+e.name||""}`},n.map((t=>{const{dataIndex:o="",customRender:a,align:n="center"}=t,l=a&&p(a);return c("td",{class:["file-table-td",n],key:o},l?null==a?void 0:a({text:e[o],record:e}):e[o])})))))))}}),le=n({components:{BasicModal:_,Upload:P,Alert:k,FileList:ne},props:W,setup(e,{emit:n}){const{t:l}=t(),i=m(!1),r=m([]),s=f({fileList:[]}),[u,{closeModal:d}]=B(),{accept:x,helpText:v,maxNumber:w,maxSize:R}=g(e),{getAccept:y,getStringAccept:C,getHelpText:S}=function({acceptRef:e,helpTextRef:t,maxNumberRef:n,maxSizeRef:l}){const i=o((()=>{const t=a(e);return t&&t.length>0?t:[]})),r=o((()=>a(i).map((e=>`.${e}`)).join(","))),s=o((()=>{const o=a(t);if(o)return o;const i=[],r=a(e);r.length>0&&i.push($("component.upload.accept",[r.join(",")]));const s=a(l);s&&i.push($("component.upload.maxSize",[s]));const u=a(n);return u&&Infinity!==u&&i.push($("component.upload.maxNumber",[u])),i.join("ï¼Œ")}));return{getAccept:i,getStringAccept:r,getHelpText:s}}({acceptRef:x,helpTextRef:v,maxNumberRef:w,maxSizeRef:R}),{createMessage:U}=b(),j=o((()=>r.value.length>0&&!r.value.every((e=>e.status===H.SUCCESS)))),k=o((()=>{const e=r.value.some((e=>e.status===H.SUCCESS));return{disabled:i.value||0===r.value.length||!e}})),P=o((()=>{const e=r.value.some((e=>e.status===H.ERROR));return i.value?l("component.upload.uploading"):l(e?"component.upload.reUploadFailed":"component.upload.startUpload")}));return{columns:[{dataIndex:"thumbUrl",title:te("component.upload.legend"),width:100,customRender:({record:e})=>{const{thumbUrl:t}=e||{};return t&&c(J,{fileUrl:t})}},{dataIndex:"name",title:te("component.upload.fileName"),align:"left",customRender:({text:e,record:t})=>{const{percent:o,status:a}=t||{};let n="normal";return a===H.ERROR?n="exception":a===H.UPLOADING?n="active":a===H.SUCCESS&&(n="success"),c("span",null,c("p",{class:"ellipsis mb-1",title:e},e),c(O,{percent:o,size:"small",status:n}))}},{dataIndex:"size",title:te("component.upload.fileSize"),width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{dataIndex:"status",title:te("component.upload.fileStatue"),width:100,customRender:({text:e})=>e===H.SUCCESS?c(I,{color:"green"},(()=>te("component.upload.uploadSuccess"))):e===H.ERROR?c(I,{color:"red"},(()=>te("component.upload.uploadError"))):e===H.UPLOADING?c(I,{color:"blue"},(()=>te("component.upload.uploading"))):e}],actionColumn:oe((function(e){const t=r.value.findIndex((t=>t.uuid===e.uuid));-1!==t&&r.value.splice(t,1)}),(function(e){const{thumbUrl:t=""}=e;N({imageList:[t]})})),register:u,closeModal:d,getHelpText:S,getStringAccept:C,getOkButtonProps:k,beforeUpload:function(t){const{size:o,name:n}=t,{maxSize:i}=e,s=a(y);if(i&&t.size/1024/1024>=i)return U.error(l("component.upload.maxSizeMultiple",[i])),!1;if(s.length>0&&!function(e,t){const o=t.join("|");return new RegExp("\\.("+o+")$","i").test(e.name)}(t,s))return U.error(l("acomponent.upload.cceptUpload",[s.join(",")])),!1;const u={uuid:z(),file:t,size:o,name:n,percent:0,type:n.split(".").pop()};return X(t)?function(e){return new Promise(((t,o)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t({result:a.result,file:e}),a.onerror=e=>o(e)}))}(t).then((({result:e})=>{r.value=[...a(r),{thumbUrl:e,...u}]})):r.value=[...a(r),u],!1},fileListRef:r,state:s,isUploadingRef:i,handleStartUpload:async function(){const{maxNumber:t}=e;if(r.value.length>t)return U.warning(l("component.upload.maxNumber",[t]));try{i.value=!0;const t=r.value.filter((e=>e.status!==H.SUCCESS))||[],o=await Promise.all(t.map((t=>async function(t){const{api:o}=e;if(!o||!p(o))return h("upload api must exist and be a function");try{t.status=H.UPLOADING;const{data:o}=await F({...e.uploadParams||{},file:t.file},(function(e){const o=e.loaded/e.total*100|0;t.percent=o}));return t.status=H.SUCCESS,t.responseData=o,{success:!0,error:null}}catch(e){return t.status=H.ERROR,{success:!1,error:e}}}(t))));i.value=!1;const a=o.filter((e=>!e.success));if(a.length>0)throw a}catch(e){throw i.value=!1,e}},handleOk:function(){const{maxNumber:t}=e;if(r.value.length>t)return U.warning(l("component.upload.maxNumber",[t]));if(i.value)return U.warning(l("component.upload.saveWarn"));const o=[];for(const e of r.value){const{status:t,responseData:a}=e;t===H.SUCCESS&&a&&o.push(a.url)}if(o.length<=0)return U.warning(l("component.upload.saveError"));r.value=[],d(),n("change",o)},handleCloseFunc:function(){return i.value?(U.warning(l("component.upload.uploadWait")),!1):(r.value=[],!0)},getIsSelectFile:j,getUploadBtnText:P,t:l}}});const ie={class:"upload-modal-toolbar"};le.render=function(e,t,o,a,n,l){const i=x("a-button"),u=x("Alert"),d=x("Upload"),c=x("FileList"),p=x("BasicModal");return r(),s(p,C({width:"800px",title:e.t("component.upload.upload"),okText:e.t("component.upload.save")},e.$attrs,{onRegister:e.register,onOk:e.handleOk,closeFunc:e.handleCloseFunc,maskClosable:!1,keyboard:!1,wrapClassName:"upload-modal",okButtonProps:e.getOkButtonProps,cancelButtonProps:{disabled:e.isUploadingRef}}),{centerdFooter:v((()=>[w(i,{onClick:e.handleStartUpload,color:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:v((()=>[R(y(e.getUploadBtnText),1)])),_:1},8,["onClick","disabled","loading"])])),default:v((()=>[w("div",ie,[w(u,{message:e.getHelpText,type:"info",banner:"",class:"upload-modal-toolbar__text"},null,8,["message"]),w(d,{accept:e.getStringAccept,multiple:e.multiple,"before-upload":e.beforeUpload,class:"upload-modal-toolbar__btn"},{default:v((()=>[w(i,{type:"primary"},{default:v((()=>[R(y(e.t("component.upload.choose")),1)])),_:1})])),_:1},8,["accept","multiple","before-upload"])]),w(c,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])])),_:1},16,["title","okText","onRegister","onOk","closeFunc","okButtonProps","cancelButtonProps"])};var re=n({components:{BasicModal:_,FileList:ne},props:V,setup(e,{emit:o}){const[n,{closeModal:l}]=B(),{t:i}=t(),r=m([]);return S((()=>e.value),(e=>{r.value=[],e.forEach((e=>{r.value=[...a(r),{url:e,type:e.split(".").pop()||"",name:e.split("/").pop()||""}]}))}),{immediate:!0}),{t:i,register:n,closeModal:l,fileListRef:r,columns:[{dataIndex:"url",title:te("component.upload.legend"),width:100,customRender:({record:e})=>{const{url:t}=e||{};return Y(t)&&c(J,{fileUrl:t})}},{dataIndex:"name",title:te("component.upload.fileName"),align:"left"}],actionColumn:ae({handleRemove:function(e){const t=r.value.findIndex((t=>t.url===e.url));-1!==t&&(r.value.splice(t,1),o("list-change",r.value.map((e=>e.url))))},handlePreview:function(e){const{url:t=""}=e;N({imageList:[t]})},handleDownload:function(e){const{url:t=""}=e;D({url:t})}})}}});re.render=function(e,t,o,a,n,l){const i=x("FileList"),u=x("BasicModal");return r(),s(u,C({width:"800px",title:e.t("component.upload.preview"),wrapClassName:"upload-preview-modal"},e.$attrs,{onRegister:e.register,showOkBtn:!1}),{default:v((()=>[w(i,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])])),_:1},16,["title","onRegister"])};var se=n({name:"BasicUpload",components:{UploadModal:le,UploadPreviewModal:re,Icon:T,Tooltip:L},props:q,setup(e,{emit:n,attrs:l}){const{t:i}=t(),[r,{openModal:s}]=E(),[u,{openModal:d}]=E(),c=m([]),p=o((()=>{const{emptyHidePreview:t}=e;return!t||(!t||c.value.length>0)})),f=o((()=>{const t={...l,...e};return j(t,"onChange")}));return S((()=>e.value),((e=[])=>{c.value=e}),{immediate:!0}),{registerUploadModal:r,openUploadModal:s,handleChange:function(e){c.value=[...a(c),...e||[]],n("change",c.value)},handlePreviewChange:function(e){c.value=[...e||[]],n("change",c.value)},registerPreviewModal:u,openPreviewModal:d,fileListRef:c,showPreview:p,bindValue:f,t:i}}});se.render=function(e,t,o,a,n,l){const i=x("a-button"),d=x("Icon"),c=x("Tooltip"),p=x("a-button-group"),m=x("UploadModal"),f=x("UploadPreviewModal");return r(),s("div",null,[w(p,null,{default:v((()=>[w(i,{type:"primary",onClick:e.openUploadModal,preIcon:"carbon:cloud-upload"},{default:v((()=>[R(y(e.t("component.upload.upload")),1)])),_:1},8,["onClick"]),e.showPreview?(r(),s(c,{key:0,placement:"bottom"},{title:v((()=>[R(y(e.t("component.upload.uploaded"))+" ",1),e.fileListRef.length?(r(),s(U,{key:0},[R(y(e.fileListRef.length),1)],64)):u("",!0)])),default:v((()=>[w(i,{onClick:e.openPreviewModal},{default:v((()=>[w(d,{icon:"bi:eye"}),e.fileListRef.length&&e.showPreviewNumber?(r(),s(U,{key:0},[R(y(e.fileListRef.length),1)],64)):u("",!0)])),_:1},8,["onClick"])])),_:1})):u("",!0)])),_:1}),w(m,C(e.bindValue,{onRegister:e.registerUploadModal,onChange:e.handleChange}),null,16,["onRegister","onChange"]),w(f,{value:e.fileListRef,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange},null,8,["value","onRegister","onListChange"])])};export default se;